# 開発セッションログ (2025-08-17)

## 1️⃣ LightningCSS ビルド失敗の調査と解決

| 時刻 | 内容 |
|------|------|
| 09:00 | CI の Linux で `lightningcss.linux-x64-gnu.node` が見つからずビルド失敗 |
| 09:20 | Tailwind 4.1.0 → 4.1.12 に戻す・`overrides` 削除で解決 |
| 09:40 | `optionalDependencies` に `lightningcss-linux-x64-gnu` を追加して確実に成功 |

---

## 2️⃣ フロント・バックエンド型共通化 (試行)
1. `shared/src/types.ts` を作成し `Todo` 型を定義
2. `backend/src/worker.ts` で `import type` し Hono RPC ルート (`apiRoutes`) を導入
3. `frontend/src/api/todoApi.ts` を `hono/client` ベースに差し替え
4. `frontend/package.json` に `hono` 依存を追加

> ✅ 型安全は確保できたが、工数計測のため一旦 **ロールバック** することに。

---

## 3️⃣ 型共通化をロールバックし元構成へ
- `frontend/src/api/todoApi.ts` を **fetch ベース**に戻す
- `frontend/package.json` から `hono` 依存を削除
- `backend/src/worker.ts` から shared 型 import を削除しローカル `interface` 復元
- `frontend/package.json` の末尾カンマ削除 → `npm install` 成功確認

<details>
<summary>修正の主なファイル</summary>

* frontend/src/api/todoApi.ts  (型安全クライアント → fetch クライアント)
* frontend/package.json        (`hono` 依存削除 + 構文修正)
* backend/src/worker.ts        (shared 型 import を削除)
* shared/src/types.ts          (当面未使用)
</details>

---

## 4️⃣ Cloudflare Workers 対応
1. `backend/wrangler.toml` 追加 (`nodejs_compat` フラグ含む)
2. `backend/src/worker.ts` を Workers エントリポイントとして整理
3. `npm run dev:workers` / `npm run deploy` スクリプトを追加

> 開発者は **Workers URL にデプロイ後** フロント側 `API_BASE_URL` を変更して利用可。

---

## 今後のTODO
- 型共通化を正式導入する場合の工数見積り
  * フロント 1 ファイル + バックエンド 1 ファイル + shared フォルダ → 合計 3〜4 ファイル変更
- Front ↔ Back 接続 URL を .env / 環境変数で切り替える仕組み追加
